# Product API Documentation

## üìã T·ªïng quan

Product API cung c·∫•p c√°c ch·ª©c nƒÉng qu·∫£n l√Ω s·∫£n ph·∫©m tr√™n Nhanh.vn, bao g·ªìm t√¨m ki·∫øm, l·∫•y chi ti·∫øt, qu·∫£n l√Ω danh m·ª•c v√† c√°c thao t√°c kh√°c.

## üîç Product Search

### Endpoint
```
POST /api/product/search
```

### M√¥ t·∫£
T√¨m ki·∫øm s·∫£n ph·∫©m theo c√°c ti√™u ch√≠ v·ªõi h·ªó tr·ª£ ph√¢n trang v√† s·∫Øp x·∫øp.

### Parameters

#### C∆° b·∫£n
| Parameter | Type | Required | M√¥ t·∫£ |
|-----------|------|----------|-------|
| `page` | int | No | S·ªë trang (m·∫∑c ƒë·ªãnh: 1) |
| `limit` | int | No | S·ªë s·∫£n ph·∫©m/trang (t·ªëi ƒëa: 100) |
| `sort` | array | No | S·∫Øp x·∫øp k·∫øt qu·∫£ |

#### T√¨m ki·∫øm
| Parameter | Type | Required | M√¥ t·∫£ |
|-----------|------|----------|-------|
| `name` | string | No | T√¨m theo t√™n, m√£, m√£ v·∫°ch |
| `parentId` | int | No | ID s·∫£n ph·∫©m cha (-1: ƒë·ªôc l·∫≠p, -2: cha) |
| `categoryId` | int | No | ID danh m·ª•c s·∫£n ph·∫©m |
| `status` | string | No | Tr·∫°ng th√°i s·∫£n ph·∫©m |
| `brandId` | int | No | ID th∆∞∆°ng hi·ªáu |
| `imei` | string | No | T√¨m theo IMEI |

#### Kho·∫£ng gi√°
| Parameter | Type | Required | M√¥ t·∫£ |
|-----------|------|----------|-------|
| `priceFrom` | float | No | Gi√° t·ª´ (>=) |
| `priceTo` | float | No | Gi√° ƒë·∫øn (<=) |

#### Flags hi·ªÉn th·ªã
| Parameter | Type | Required | M√¥ t·∫£ |
|-----------|------|----------|-------|
| `showHot` | int | No | S·∫£n ph·∫©m hot (0/1) |
| `showNew` | int | No | S·∫£n ph·∫©m m·ªõi (0/1) |
| `showHome` | int | No | Hi·ªÉn th·ªã trang ch·ªß (0/1) |

#### Th·ªùi gian c·∫≠p nh·∫≠t
| Parameter | Type | Required | M√¥ t·∫£ |
|-----------|------|----------|-------|
| `updatedDateTimeFrom` | string | No | T·ª´ ng√†y (Y-m-d H:i:s) |
| `updatedDateTimeTo` | string | No | ƒê·∫øn ng√†y (Y-m-d H:i:s) |

### V√≠ d·ª• s·ª≠ d·ª•ng

```php
// T√¨m ki·∫øm c∆° b·∫£n
$products = $client->products()->search([
    'page' => 1,
    'limit' => 50
]);

// T√¨m ki·∫øm theo t√™n
$products = $client->products()->search([
    'name' => 'iPhone',
    'limit' => 20
]);

// T√¨m ki·∫øm theo danh m·ª•c v√† gi√°
$products = $client->products()->search([
    'categoryId' => 123,
    'priceFrom' => 1000000,
    'priceTo' => 5000000,
    'showHot' => 1
]);

// T√¨m ki·∫øm s·∫£n ph·∫©m m·ªõi c·∫≠p nh·∫≠t
$products = $client->products()->search([
    'updatedDateTimeFrom' => '2024-01-01 00:00:00',
    'updatedDateTimeTo' => '2024-01-31 23:59:59'
]);
```

### Response Structure

```json
{
    "code": 1,
    "data": {
        "totalPages": 30,
        "products": [
            {
                "idNhanh": 5003206,
                "code": "IPHONE-15",
                "name": "iPhone 15 Pro Max",
                "price": 25000000,
                "wholesalePrice": 23000000,
                "importPrice": 20000000,
                "status": "Active",
                "categoryId": 123,
                "brandId": 456,
                "inventory": {
                    "remain": 50,
                    "available": 45,
                    "shipping": 3,
                    "holding": 2
                }
            }
        ]
    }
}
```

## üîç Product Detail

### Endpoint
```
POST /api/product/detail
```

### M√¥ t·∫£
L·∫•y th√¥ng tin chi ti·∫øt c·ªßa s·∫£n ph·∫©m theo ID, bao g·ªìm t·∫•t c·∫£ thu·ªôc t√≠nh v√† th√¥ng tin t·ªìn kho.

### Parameters

| Parameter | Type | Required | M√¥ t·∫£ |
|-----------|------|----------|-------|
| `productId` | int | Yes | ID s·∫£n ph·∫©m tr√™n Nhanh.vn |

### V√≠ d·ª• s·ª≠ d·ª•ng

```php
$product = $client->products()->detail(5003206);

if ($product) {
    echo "T√™n: " . $product->getName();
    echo "M√£: " . $product->getCode();
    echo "Gi√°: " . $product->getFormattedPrice();
    echo "T·ªìn kho: " . $product->getAvailableQuantity();
    echo "Tr·∫°ng th√°i: " . $product->getStatus();
}
```

### Response Fields

#### Th√¥ng tin c∆° b·∫£n
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `idNhanh` | bigint | ID s·∫£n ph·∫©m tr√™n Nhanh.vn |
| `code` | string | M√£ s·∫£n ph·∫©m |
| `name` | string | T√™n s·∫£n ph·∫©m |
| `otherName` | string | T√™n kh√°c c·ªßa s·∫£n ph·∫©m |
| `barcode` | string | M√£ v·∫°ch s·∫£n ph·∫©m |
| `status` | string | Tr·∫°ng th√°i s·∫£n ph·∫©m |

#### Th√¥ng tin gi√°
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `importPrice` | double | Gi√° nh·∫≠p |
| `oldPrice` | double | Gi√° c≈© |
| `price` | double | Gi√° b√°n l·∫ª |
| `wholesalePrice` | double | Gi√° b√°n bu√¥n |
| `vat` | int | % thu·∫ø VAT |

#### Ph√¢n lo·∫°i
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `categoryId` | int | ID danh m·ª•c s·∫£n ph·∫©m |
| `brandId` | int | ID th∆∞∆°ng hi·ªáu |
| `brandName` | string | T√™n th∆∞∆°ng hi·ªáu |
| `typeId` | int | ID lo·∫°i s·∫£n ph·∫©m |
| `typeName` | string | T√™n lo·∫°i s·∫£n ph·∫©m |
| `parentId` | bigint | ID s·∫£n ph·∫©m cha |

#### K√≠ch th∆∞·ªõc & Tr·ªçng l∆∞·ª£ng
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `width` | int | Chi·ªÅu r·ªông (cm) |
| `height` | int | Chi·ªÅu cao (cm) |
| `length` | int | Chi·ªÅu d√†i (cm) |
| `shippingWeight` | int | Tr·ªçng l∆∞·ª£ng (gram) |

#### B·∫£o h√†nh
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `warranty` | int | S·ªë th√°ng b·∫£o h√†nh |
| `warrantyAddress` | string | ƒê·ªãa ch·ªâ b·∫£o h√†nh |
| `warrantyPhone` | string | S·ªë ƒëi·ªán tho·∫°i b·∫£o h√†nh |
| `warrantyContent` | string | N·ªôi dung b·∫£o h√†nh |

#### Hi·ªÉn th·ªã
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `showHot` | int | S·∫£n ph·∫©m hot (0/1) |
| `showNew` | int | S·∫£n ph·∫©m m·ªõi (0/1) |
| `showHome` | int | Hi·ªÉn th·ªã trang ch·ªß (0/1) |

#### Th√¥ng tin kh√°c
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `createdDateTime` | datetime | Ng√†y t·∫°o s·∫£n ph·∫©m |
| `countryName` | string | Xu·∫•t x·ª© |
| `unit` | string | ƒê∆°n v·ªã t√≠nh |
| `previewLink` | string | Link xem s·∫£n ph·∫©m |

#### H√¨nh ·∫£nh
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `image` | string | ·∫¢nh ƒë·∫°i di·ªán |
| `images` | array | Danh s√°ch ·∫£nh kh√°c |

#### T·ªìn kho
| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `inventory` | object | Th√¥ng tin t·ªìn kho chi ti·∫øt |

## üìÇ Product Categories

### Endpoint
```
POST /product/category
```

### M√¥ t·∫£
L·∫•y danh s√°ch t·∫•t c·∫£ danh m·ª•c s·∫£n ph·∫©m tr√™n Nhanh.vn.

### Parameters
Kh√¥ng c√≥ parameters b·∫Øt bu·ªôc.

### V√≠ d·ª• s·ª≠ d·ª•ng

```php
$categories = $client->products()->getCategories();

foreach ($categories as $category) {
    echo "T√™n: " . $category->getName();
    echo "M√¥ t·∫£: " . $category->getDescription();
    echo "S·ªë s·∫£n ph·∫©m: " . $category->getProductCount();
    echo "Level: " . $category->getLevel();
    echo "Parent ID: " . $category->getParentId();
}
```

### Response Fields

| Field | Type | M√¥ t·∫£ |
|-------|------|--------|
| `id` | int | ID danh m·ª•c |
| `name` | string | T√™n danh m·ª•c |
| `description` | string | M√¥ t·∫£ danh m·ª•c |
| `productCount` | int | S·ªë s·∫£n ph·∫©m trong danh m·ª•c |
| `level` | int | C·∫•p ƒë·ªô danh m·ª•c |
| `parentId` | int | ID danh m·ª•c cha |
| `order` | int | Th·ª© t·ª± hi·ªÉn th·ªã |
| `status` | string | Tr·∫°ng th√°i danh m·ª•c |
| `slug` | string | URL slug |
| `metaTitle` | string | Meta title SEO |
| `metaDescription` | string | Meta description SEO |
| `metaKeywords` | string | Meta keywords SEO |

## üèóÔ∏è Architecture

### ProductModule Class

```php
class ProductModule
{
    /**
     * T√¨m ki·∫øm s·∫£n ph·∫©m theo c√°c ti√™u ch√≠
     *
     * @param array $criteria C√°c ti√™u ch√≠ t√¨m ki·∫øm
     * @return Collection Collection c√°c s·∫£n ph·∫©m t√¨m ƒë∆∞·ª£c
     * @throws Exception Khi c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh t√¨m ki·∫øm
     */
    public function search(array $criteria = []): Collection;

    /**
     * L·∫•y chi ti·∫øt s·∫£n ph·∫©m theo ID
     *
     * @param int $productId ID s·∫£n ph·∫©m tr√™n Nhanh.vn
     * @return Product|null S·∫£n ph·∫©m chi ti·∫øt ho·∫∑c null n·∫øu kh√¥ng t√¨m th·∫•y
     * @throws Exception Khi c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh l·∫•y chi ti·∫øt
     */
    public function detail(int $productId): ?Product;

    /**
     * L·∫•y danh m·ª•c s·∫£n ph·∫©m t·ª´ API Nhanh.vn
     *
     * @return array M·∫£ng c√°c danh m·ª•c s·∫£n ph·∫©m
     * @throws Exception Khi c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh l·∫•y danh m·ª•c
     */
    public function getCategories(): array;
}
```

### Memory Management

Module t·ª± ƒë·ªông qu·∫£n l√Ω memory th√¥ng qua helper methods:

```php
// T·∫°o entities t·ª´ API response v·ªõi memory management
$products = $this->createEntitiesFromApiResponse($response, 'createProduct', 'products');

// T·∫°o entities t·ª´ cached data v·ªõi memory management
$categories = $this->createEntitiesWithMemoryManagement($cachedData, 'createProductCategories');
```

## üö® Error Handling

### ApiException
```php
try {
    $product = $client->products()->detail($productId);
} catch (ApiException $e) {
    echo "API Error: " . $e->getMessage();
    echo "HTTP Status: " . $e->getHttpStatusCode();
    echo "Response Body: " . $e->getResponseBody();
    echo "Error Code: " . $e->getErrorCode();
    echo "Error Data: " . json_encode($e->getErrorData());
}
```

### Error Response Structure
```json
{
    "code": 0,
    "messages": ["Invalid product ID"],
    "errorCode": "INVALID_PRODUCT",
    "errorData": {
        "productId": 5003206,
        "reason": "Product not found"
    }
}
```

## üîç Logging

### Debug Logging
```php
// C·∫•u h√¨nh logger
$client->setLogger($monologAdapter);

// Logs s·∫Ω ƒë∆∞·ª£c ghi t·ª± ƒë·ªông:
// - Search criteria
// - API calls
// - Response parsing
// - Entity creation
// - Memory management
```

### Log Levels
- **DEBUG**: Chi ti·∫øt API calls v√† responses
- **INFO**: Th√¥ng tin ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
- **WARNING**: C·∫£nh b√°o v·ªÅ data kh√¥ng h·ª£p l·ªá
- **ERROR**: L·ªói x·∫£y ra trong qu√° tr√¨nh x·ª≠ l√Ω

## üí° Best Practices

### 1. S·ª≠ d·ª•ng Collection methods
```php
$products = $client->products()->search(['limit' => 100]);

// Filter s·∫£n ph·∫©m c√≥ s·∫µn
$availableProducts = $products->filter(function($product) {
    return $product->getAvailableQuantity() > 0;
});

// Map ƒë·ªÉ l·∫•y th√¥ng tin c·∫ßn thi·∫øt
$productInfo = $products->map(function($product) {
    return [
        'id' => $product->getIdNhanh(),
        'name' => $product->getName(),
        'price' => $product->getFormattedPrice()
    ];
});
```

### 2. Error handling
```php
try {
    $product = $client->products()->detail($productId);
    if (!$product) {
        echo "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m";
        return;
    }
    // X·ª≠ l√Ω s·∫£n ph·∫©m
} catch (ApiException $e) {
    // X·ª≠ l√Ω l·ªói API
    logError($e);
} catch (Exception $e) {
    // X·ª≠ l√Ω l·ªói chung
    logError($e);
}
```

### 3. Memory optimization
```php
// S·ª≠ d·ª•ng helper methods ƒë·ªÉ t·ª± ƒë·ªông qu·∫£n l√Ω memory
$products = $this->createEntitiesFromApiResponse($response, 'createProduct');

// Kh√¥ng c·∫ßn unset() th·ªß c√¥ng - ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω t·ª± ƒë·ªông
```

## üìö Related Documentation

- [OAuth API](oauth.md) - X√°c th·ª±c v√† authorization
- [Error Handling](errors.md) - X·ª≠ l√Ω l·ªói v√† exceptions
- [Logging](logging.md) - C·∫•u h√¨nh v√† s·ª≠ d·ª•ng logging
- [Memory Management](memory.md) - Qu·∫£n l√Ω memory trong SDK
