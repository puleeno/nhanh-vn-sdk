<?php
/**
 * Demo Nhanh Client Builder
 *
 * File n√†y demo c√°c c√°ch kh√°c nhau ƒë·ªÉ t·∫°o NhanhVnClient s·ª≠ d·ª•ng NhanhClientBuilder
 */

require_once __DIR__ . '/../../vendor/autoload.php';

use Puleeno\NhanhVn\Client\NhanhClientBuilder;

// Thi·∫øt l·∫≠p error reporting
error_reporting(E_ALL);
ini_set('display_errors', 1);

?>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Nhanh Client Builder Demo</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .demo-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .info {
            color: #17a2b8;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Nhanh Client Builder Demo</h1>
        <p class="subtitle">Demo c√°c c√°ch kh√°c nhau ƒë·ªÉ t·∫°o NhanhVnClient v·ªõi syntax g·ªçn g√†ng</p>
        <hr>

        <div class="demo-section">
            <h2>üéØ Demo 1: T·∫°o Client C∆° B·∫£n</h2>
            <p>S·ª≠ d·ª•ng Builder Pattern v·ªõi fluent interface:</p>

            <div class="code-block">
$client = NhanhClientBuilder::create()
    ->withAppId('demo_app_id')
    ->withBusinessId('demo_business_id')
    ->withAccessToken('demo_access_token')
    ->build();
            </div>

            <?php
            try {
                $client = NhanhClientBuilder::create()
                    ->withAppId('demo_app_id')
                    ->withBusinessId('demo_business_id')
                    ->withAccessToken('demo_access_token')
                    ->build();

                echo '<p class="success">‚úÖ Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';
                echo '<p><strong>Client Info:</strong></p>';
                echo '<ul>';
                echo '<li>App ID: ' . $client->getAppId() . '</li>';
                echo '<li>Business ID: ' . $client->getBusinessId() . '</li>';
                echo '<li>API Version: ' . $client->getApiVersion() . '</li>';
                echo '<li>Configured: ' . ($client->isConfigured() ? 'Yes' : 'No') . '</li>';
                echo '</ul>';

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói: ' . $e->getMessage() . '</p>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>üîß Demo 2: T·∫°o Client v·ªõi Logging</h2>
            <p>Thi·∫øt l·∫≠p logging v·ªõi Monolog:</p>

            <div class="code-block">
$client = NhanhClientBuilder::create()
    ->withAppId('demo_app_id')
    ->withBusinessId('demo_business_id')
    ->withAccessToken('demo_access_token')
    ->withLogger()
    ->withLogLevel('DEBUG')
    ->withLogFile('logs/demo.log')
    ->withConsoleLogging()
    ->build();
            </div>

            <?php
            try {
                $client = NhanhClientBuilder::create()
                    ->withAppId('demo_app_id')
                    ->withBusinessId('demo_business_id')
                    ->withAccessToken('demo_access_token')
                    ->withLogger()
                    ->withLogLevel('DEBUG')
                    ->withLogFile('logs/demo.log')
                    ->withConsoleLogging()
                    ->build();

                echo '<p class="success">‚úÖ Client v·ªõi logging ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';
                echo '<p><strong>Logger Info:</strong></p>';
                echo '<ul>';
                echo '<li>Logger Type: ' . get_class($client->getLogger()) . '</li>';
                echo '<li>Log Level: DEBUG</li>';
                echo '<li>Log File: logs/demo.log</li>';
                echo '<li>Console Logging: Enabled</li>';
                echo '</ul>';

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói: ' . $e->getMessage() . '</p>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>üåç Demo 3: Environment Presets</h2>
            <p>S·ª≠ d·ª•ng c√°c preset c√≥ s·∫µn cho development v√† production:</p>

            <div class="code-block">
// Development preset
$devClient = NhanhClientBuilder::create()
    ->withAppId('dev_app_id')
    ->withBusinessId('dev_business_id')
    ->withAccessToken('dev_access_token')
    ->forDevelopment()
    ->build();

// Production preset
$prodClient = NhanhClientBuilder::create()
    ->withAppId('prod_app_id')
    ->withBusinessId('prod_business_id')
    ->withAccessToken('prod_access_token')
    ->forProduction()
    ->build();
            </div>

            <?php
            try {
                // Development client
                $devClient = NhanhClientBuilder::create()
                    ->withAppId('dev_app_id')
                    ->withBusinessId('dev_business_id')
                    ->withAccessToken('dev_access_token')
                    ->forDevelopment()
                    ->build();

                echo '<p class="success">‚úÖ Development Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';
                echo '<p class="info">üîß Development preset: Logging DEBUG, Console enabled, SSL disabled</p>';

                // Production client
                $prodClient = NhanhClientBuilder::create()
                    ->withAppId('prod_app_id')
                    ->withBusinessId('prod_business_id')
                    ->withAccessToken('prod_access_token')
                    ->forProduction()
                    ->build();

                echo '<p class="success">‚úÖ Production Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';
                echo '<p class="info">üöÄ Production preset: Logging WARNING, File logging, SSL enabled</p>';

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói: ' . $e->getMessage() . '</p>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>üöÄ Demo 4: Static Convenience Methods</h2>
            <p>S·ª≠ d·ª•ng c√°c method ti·ªán √≠ch ƒë·ªÉ t·∫°o client nhanh:</p>

            <div class="code-block">
// T·∫°o client c∆° b·∫£n
$client = NhanhClientBuilder::createBasic(
    'demo_app_id',
    'demo_business_id',
    'demo_access_token'
);

// T·∫°o client cho development
$devClient = NhanhClientBuilder::createDevelopment(
    'dev_app_id',
    'dev_business_id',
    'dev_access_token'
);

// T·∫°o client cho production
$prodClient = NhanhClientBuilder::createProduction(
    'prod_app_id',
    'prod_business_id',
    'prod_access_token'
);
            </div>

            <?php
            try {
                // Basic client
                $basicClient = NhanhClientBuilder::createBasic(
                    'basic_app_id',
                    'basic_business_id',
                    'basic_access_token'
                );
                echo '<p class="success">‚úÖ Basic Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';

                // Development client
                $devClient = NhanhClientBuilder::createDevelopment(
                    'dev_app_id',
                    'dev_business_id',
                    'dev_access_token'
                );
                echo '<p class="success">‚úÖ Development Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';

                // Production client
                $prodClient = NhanhClientBuilder::createProduction(
                    'prod_app_id',
                    'prod_business_id',
                    'prod_access_token'
                );
                echo '<p class="success">‚úÖ Production Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói: ' . $e->getMessage() . '</p>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>üîê Demo 5: OAuth Client</h2>
            <p>T·∫°o client cho OAuth flow:</p>

            <div class="code-block">
$oauthClient = NhanhClientBuilder::fromOAuth()
    ->withAppId('oauth_app_id')
    ->withSecretKey('oauth_secret_key')
    ->withRedirectUrl('https://demo.com/callback')
    ->build();
            </div>

            <?php
            try {
                $oauthClient = NhanhClientBuilder::fromOAuth()
                    ->withAppId('oauth_app_id')
                    ->withSecretKey('oauth_secret_key')
                    ->withRedirectUrl('https://demo.com/callback')
                    ->build();

                echo '<p class="success">‚úÖ OAuth Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';
                echo '<p><strong>OAuth Info:</strong></p>';
                echo '<ul>';
                echo '<li>App ID: ' . $oauthClient->getAppId() . '</li>';
                echo '<li>Redirect URL: https://demo.com/callback</li>';
                echo '<li>OAuth URL: ' . $oauthClient->getOAuthUrl('https://demo.com/callback') . '</li>';
                echo '</ul>';

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói: ' . $e->getMessage() . '</p>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>üìÅ Demo 6: T·ª´ File Config</h2>
            <p>T·∫°o client t·ª´ file JSON config:</p>

            <div class="code-block">
// T·∫°o file config.json
{
    "appId": "file_app_id",
    "businessId": "file_business_id",
    "accessToken": "file_access_token",
    "enableLogging": true,
    "logLevel": "INFO"
}

// S·ª≠ d·ª•ng trong code
$client = NhanhClientBuilder::fromConfigFile('config.json')->build();
            </div>

            <?php
            try {
                // T·∫°o file config t·∫°m th·ªùi
                $configData = [
                    'appId' => 'file_app_id',
                    'businessId' => 'file_business_id',
                    'accessToken' => 'file_access_token',
                    'enableLogging' => true,
                    'logLevel' => 'INFO'
                ];

                $configFile = __DIR__ . '/temp_config.json';
                file_put_contents($configFile, json_encode($configData, JSON_PRETTY_PRINT));

                // T·∫°o client t·ª´ file config
                $fileClient = NhanhClientBuilder::fromConfigFile($configFile)->build();

                echo '<p class="success">‚úÖ Client t·ª´ file config ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';
                echo '<p><strong>Config File Info:</strong></p>';
                echo '<ul>';
                echo '<li>Config File: ' . basename($configFile) . '</li>';
                echo '<li>App ID: ' . $fileClient->getAppId() . '</li>';
                echo '<li>Business ID: ' . $fileClient->getBusinessId() . '</li>';
                echo '<li>Logging Enabled: ' . ($fileClient->getLogger() instanceof \Puleeno\NhanhVn\Services\Logger\NullLogger ? 'No' : 'Yes') . '</li>';
                echo '</ul>';

                // X√≥a file config t·∫°m th·ªùi
                unlink($configFile);

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói: ' . $e->getMessage() . '</p>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>üåç Demo 7: T·ª´ Environment Variables</h2>
            <p>T·∫°o client t·ª´ environment variables:</p>

            <div class="code-block">
// Thi·∫øt l·∫≠p environment variables
$_ENV['NHANH_APP_ID'] = 'env_app_id';
$_ENV['NHANH_BUSINESS_ID'] = 'env_business_id';
$_ENV['NHANH_ACCESS_TOKEN'] = 'env_access_token';
$_ENV['NHANH_LOG_LEVEL'] = 'DEBUG';

// T·∫°o client
$client = NhanhClientBuilder::fromEnvironment()->build();
            </div>

            <?php
            try {
                // Thi·∫øt l·∫≠p environment variables t·∫°m th·ªùi
                $_ENV['NHANH_APP_ID'] = 'env_app_id';
                $_ENV['NHANH_BUSINESS_ID'] = 'env_business_id';
                $_ENV['NHANH_ACCESS_TOKEN'] = 'env_access_token';
                $_ENV['NHANH_LOG_LEVEL'] = 'DEBUG';

                // T·∫°o client t·ª´ environment
                $envClient = NhanhClientBuilder::fromEnvironment()->build();

                echo '<p class="success">‚úÖ Client t·ª´ environment ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';
                echo '<p><strong>Environment Info:</strong></p>';
                echo '<ul>';
                echo '<li>App ID: ' . $envClient->getAppId() . '</li>';
                echo '<li>Business ID: ' . $envClient->getBusinessId() . '</li>';
                echo '<li>Access Token: ' . $envClient->getAccessToken() . '</li>';
                echo '<li>Log Level: DEBUG</li>';
                echo '</ul>';

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói: ' . $e->getMessage() . '</p>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>‚ö†Ô∏è Demo 8: Validation v√† Error Handling</h2>
            <p>Demo validation t·ª± ƒë·ªông v√† error handling:</p>

            <div class="code-block">
try {
    $client = NhanhClientBuilder::create()
        ->withAppId('app_id')
        // Thi·∫øu businessId v√† accessToken
        ->build();
} catch (Exception $e) {
    echo "L·ªói: " . $e->getMessage();
}
            </div>

            <?php
            try {
                $client = NhanhClientBuilder::create()
                    ->withAppId('app_id')
                    // Thi·∫øu businessId v√† accessToken
                    ->build();

                echo '<p class="success">‚úÖ Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng (kh√¥ng n√™n x·∫£y ra)</p>';

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói validation (ƒë√∫ng nh∆∞ mong ƒë·ª£i):</p>';
                echo '<div class="code-block">' . htmlspecialchars($e->getMessage()) . '</div>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>üéØ Demo 9: Custom Configuration</h2>
            <p>Thi·∫øt l·∫≠p configuration t√πy ch·ªânh:</p>

            <div class="code-block">
$client = NhanhClientBuilder::create()
    ->withAppId('custom_app_id')
    ->withBusinessId('custom_business_id')
    ->withAccessToken('custom_access_token')
    ->withApiVersion('2.1')
    ->withTimeout(60)
    ->withRetryAttempts(5)
    ->withRateLimit(300)
    ->withLogger()
    ->withLogLevel('INFO')
    ->withLogFile('logs/custom.log')
    ->withConsoleLogging()
    ->withSSLValidation(false)
    ->build();
            </div>

            <?php
            try {
                $customClient = NhanhClientBuilder::create()
                    ->withAppId('custom_app_id')
                    ->withBusinessId('custom_business_id')
                    ->withAccessToken('custom_access_token')
                    ->withApiVersion('2.1')
                    ->withTimeout(60)
                    ->withRetryAttempts(5)
                    ->withRateLimit(300)
                    ->withLogger()
                    ->withLogLevel('INFO')
                    ->withLogFile('logs/custom.log')
                    ->withConsoleLogging()
                    ->withSSLValidation(false)
                    ->build();

                echo '<p class="success">‚úÖ Custom Client ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>';
                echo '<p><strong>Custom Configuration:</strong></p>';
                echo '<ul>';
                echo '<li>API Version: ' . $customClient->getApiVersion() . '</li>';
                echo '<li>Timeout: 60 gi√¢y</li>';
                echo '<li>Retry Attempts: 5</li>';
                echo '<li>Rate Limit: 300 requests/30s</li>';
                echo '<li>Log Level: INFO</li>';
                echo '<li>Log File: logs/custom.log</li>';
                echo '<li>Console Logging: Enabled</li>';
                echo '<li>SSL Validation: Disabled</li>';
                echo '</ul>';

            } catch (Exception $e) {
                echo '<p class="error">‚ùå L·ªói: ' . $e->getMessage() . '</p>';
            }
            ?>
        </div>

        <div class="demo-section">
            <h2>üìä T·ªïng k·∫øt</h2>
            <p><strong>Nhanh Client Builder</strong> cung c·∫•p nhi·ªÅu c√°ch kh√°c nhau ƒë·ªÉ t·∫°o NhanhVnClient:</p>

            <ul>
                <li>üéØ <strong>Builder Pattern</strong> - Fluent interface cho configuration ph·ª©c t·∫°p</li>
                <li>üöÄ <strong>Static Convenience Methods</strong> - T·∫°o client nhanh cho use cases ƒë∆°n gi·∫£n</li>
                <li>üåç <strong>Environment Presets</strong> - C·∫•u h√¨nh t·ª± ƒë·ªông cho development, production, testing</li>
                <li>üìÅ <strong>File Config</strong> - T·∫°o client t·ª´ file JSON</li>
                <li>üåç <strong>Environment Variables</strong> - T·∫°o client t·ª´ environment</li>
                <li>üîê <strong>OAuth Support</strong> - H·ªó tr·ª£ OAuth flow</li>
                <li>üìù <strong>Logging Integration</strong> - T√≠ch h·ª£p Monolog v·ªõi nhi·ªÅu t√πy ch·ªçn</li>
                <li>‚úÖ <strong>Auto Validation</strong> - Validate configuration t·ª± ƒë·ªông</li>
            </ul>

            <p class="info">üí° <strong>Tip:</strong> S·ª≠ d·ª•ng Builder Pattern cho configuration ph·ª©c t·∫°p v√† Static Methods cho configuration ƒë∆°n gi·∫£n!</p>
        </div>

        <div class="demo-section">
            <h2>üîó Li√™n k·∫øt</h2>
            <p>
                <a href="index.php" class="btn btn-primary">‚Üê Quay v·ªÅ trang ch·ªß</a>
                <a href="https://github.com/puleeno/nhanh-vn-sdk" class="btn btn-secondary" target="_blank">üìö GitHub Repository</a>
                <a href="../../docs/client-builder.md" class="btn btn-info" target="_blank">üìñ T√†i li·ªáu chi ti·∫øt</a>
            </p>
        </div>
    </div>
</body>
</html>
